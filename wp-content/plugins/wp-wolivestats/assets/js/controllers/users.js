angular.module("Wolive").controller("UsersController",["$location","$scope","$rootScope","$timeout","ajaxAdmin","Functions","$rootScope",function(e,t,s,r,n,i){var a=this;t.page_users=1,t.templatePopFilter="templatePopFilter.html",a.all=!0,a.online=!1,a.users=[],a.getIconBrow=i.classBrowser,a.getSO=i.classSO,t.userList="All",t.typeAction="visitor",a.template_user=wolive_assets_url+"js/templates/user.html",a.template_popup=wolive_assets_url+"js/templates/popup.html",t.$on("$viewContentLoaded",function(){i.setFocusEvents(function(e){t.isFocus=e}),a.resizeTemplate(),$(window).resize(a.resizeTemplate),$("#resultsUsers").on("scroll",a.endScroll),e.path().split("/").length>=2&&(t.user_init=parseInt(e.path().split("/")[2]))}),t.$on("$destroy",function(){$(window).off("resize",a.resizeTemplate),r.cancel(t.timer_scope)}),a.getOnline=function(){var e={action:"getUsersOnline",page:t.page_users};n.newRequest(e,function(e){e.data.users.length>0?a.users=a.users.concat(e.data.users):a.no_more_data=!0,a.timestamp=parseInt(e.data.timestamp),a.procesUsers()})},a.getUsers=function(){var e={action:"getAllUsers",page:t.page_users};s.filters&&(e.filters=s.filters);n.newRequest(e,function(e){e.data.users.length>0?a.users=a.users.concat(e.data.users):a.no_more_data=!0,a.timestamp=parseInt(e.data.timestamp),a.procesUsers()})},a.gotoUser=function(e){t.user_=e},a.resetList=function(){a.users=[],a.active=null,t.user_=!1,a.no_more_data=!1,t.page_users=1,r.cancel(t.timer_scope),"All"==t.userList?a.getUsers():a.getOnline(),a.resizeTemplate()},t.$watch("userList",function(){a.resetList()}),s.addFilter=function(e){a.resizeTemplate(),a.resetList()},t.removeFilter=function(e){delete s.filters[e],a.resetList(),a.resizeTemplate()},a.resizeTemplate=function(){var e=jQuery("#userList").height(),t=jQuery("#buttonsUser").height();jQuery("#resultsUsers").height(e-(t+25+20))},a.endScroll=function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){if(a.no_more_data)return!1;t.page_users++,"All"==t.userList?a.getUsers():a.getOnline()}},a.procesUsers=function(){angular.forEach(a.users,function(e,t){a.users[t].last_action=(Date.now()/1e3|0)-a.users[t].timestamp_diff,a.users[t].is_online=parseInt(a.timestamp-180)<parseInt(a.users[t].last_action_timestamp)})},a.feedBack=function(){var e={action:"getfeedBack"};n.newRequest(e,function(e){if(1==e.data.code)return!0;e.data.status<1&&i.go(url_options)})},a.feedBack()}]);